name: Sync to Azure DevOps
on:
  push:
    branches:
      - master  # Change to your branch if needed

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Git
        run: |
          git config --global user.name "Gabriel"
          git config --global user.email "gmmoreira.eng@gmail.com"  # Replace with your email

      - name: Add ADO Remote
        run: |
          git remote add ado https://${{ secrets.ADO_USERNAME }}:${{ secrets.ADO_PAT }}@dev.azure.com/gmmoreiracan/financial-planning/_git/financial-planning
          git fetch ado  # Fetch the latest from ADO

      - name: Merge changes from ADO
        run: |
          git checkout master
          git pull ado master --rebase || echo "No changes to merge"  # Use --rebase to avoid merge commits
          git merge master -m "Automated commit from Github"
      
      - name: Check for conflicts
        run: |
          if ! git diff --quiet; then
            echo "Merge conflicts detected. Please resolve them manually."
            exit 1
          fi

      - name: Push changes to Azure DevOps
        run: |
          git push ado HEAD:master